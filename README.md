# ブックマークを登録する拡張機能

## 注意事項

この拡張機能は単体では動作しません。この拡張機能を利用するためには[ブックマークを管理する web アプリケーション](https://github.com/kubotama/linkpage)が必要です。

## 機能

この拡張機能は、現在開いているタブの情報をワンクリックで[ブックマーク管理アプリケーション](https://github.com/kubotama/linkpage)に登録します。

- **自動情報取得**: アクティブなタブの URL とタイトルを自動的に取得します。
- **手動編集**: 取得したタイトルや URL は、登録前に手動で編集できます。
- **柔軟な登録**: ページのタイトルが自動で取得できない場合でも（例: `about:blank`ページなど）、手動でタイトルを入力して登録することが可能です。
- **カスタム API エンドポイント**: オプションページで、ブックマーク登録先の API エンドポイントを自由に設定できます。

### UI/UX の改善

ユーザーの利便性を高めるため、UI/UX の改善に継続的に取り組んでいます。

- **動的なポップアップ幅**: 長い URL やタイトルも快適に閲覧・編集できるよう、ポップアップの幅がコンテンツの長さに応じて動的に調整されます。
- **オプション画面のレイアウト改善**: オプション画面では CSS Grid Layout を採用し、設定項目を整然と配置することで、視認性と操作性を向上させました。
- **明確な文言**: アプリケーション全体のラベルや説明文を見直し、ユーザーが直感的に操作を理解できる、より明確で具体的な表現に改善しました。
- **ステータスに応じたメッセージ表示**: 登録処理の成功や失敗といったステータスに応じて、メッセージが色分けして表示されるため、結果を直感的に把握できます。
- **メッセージの自動非表示機能**: 一時的な通知（例: 登録成功メッセージ）のユーザー体験を向上させるため、`duration` prop を指定することで、メッセージが一定時間後に自動的に非表示になるようになりました。

## インストール方法

### リポジトリのクローン

```bash
$ git clone https://github.com/kubotama/bookmark-extension.git
```

### プロジェクトディレクトリに移動

```bash
$ cd bookmark-extension
```

### パッケージのインストール

```bash
$ npm install
```

### ビルド

```bash
$ npm run build
```

## 使用方法

1.  Chrome で `chrome://extensions` を開きます。
2.  右上の「デベロッパーモード」をオンにします。
3.  「パッケージ化されていない拡張機能を読み込む」ボタンをクリックします。
4.  ビルド時に作成された `dist` ディレクトリを選択して、拡張機能を登録します。
5.  拡張機能のアイコンを右クリックし、「オプション」を選択してオプションページを開きます。
6.  ブックマークを登録するための API のベース URL を指定します。（デフォルト: `http://localhost:3000`）

## 関連アプリケーション

[ブックマークを管理する web アプリケーション](https://github.com/kubotama/linkpage)

## 技術スタック

- [Node.js](https://nodejs.org/)
- [React](https://reactjs.org/)
- [TypeScript](https://www.typescriptlang.org/)
- [vite](https://ja.vite.dev/)
- [vitest](https://vitest.dev)

## 開発

### 非同期処理のモダン化

本プロジェクトでは、コールバックベースの古い非同期処理から、よりモダンで可読性の高い`Promise`ベースの`async/await`構文への移行を推進しています。Chrome 拡張機能 API の呼び出しや、`fetch`による HTTP リクエストなど、プロジェクト全体の非同期コードを`async/await`に統一することで、コードの可読性とメンテナンス性を高めています。

### カスタムフックによる関心の分離

本プロジェクトでは、コンポーネントの責務を明確にし、コードの再利用性と保守性を高めるために、カスタムフックによる関心の分離を積極的に採用しています。

UI ロジックとビジネスロジックを分離するために、複雑な状態管理や副作用を伴う処理はカスタムフックにカプセル化しています。

以下に、本プロジェクトで利用されている主なカスタムフックを示します。

- **`useActiveTabInfo`**: 現在アクティブなタブの URL とタイトルを取得します。
- **`useApiUrl`**: API のベース URL の取得・設定と、ブックマーク追加用 URL の生成ロジックをカプセル化します。
- **`usePopup`**: ポップアップ画面（`Popup.tsx`）の主要なロジックを集約します。
- **`useOptions`**: オプション画面（`Options.tsx`）の主要なロジックを集約します。
- **`useMessage`**: アプリケーション全体でのメッセージ（成功、エラーなど）の表示状態と、自動非表示のロジックを管理します。

例えば、ポップアップ画面（`Popup.tsx`）の主要なロジックは `usePopup` フックに集約されており、`Popup.tsx` は主に UI のレンダリングに専念する構成となっています。

同様に、オプション画面（`Options.tsx`）のロジックは `useOptions` フックにカプセル化されています。

このアプローチにより、以下のメリットがもたらされます。

- **可読性の向上**: コンポーネントのコードがシンプルになり、見通しが良くなります。
- **再利用性の向上**: 同様のロジックを複数のコンポーネントで簡単に再利用できます。
- **テストの容易性**: ビジネスロジックを UI から切り離して単体でテストすることが容易になります。

### コンポーネント指向の開発

本プロジェクトでは、UI の一貫性を保ち、コードの再利用性を高めるために、コンポーネント指向の開発アプローチを採用しています。共通の UI パターンは、再利用可能なコンポーネントとしてカプセル化し、アプリケーション全体で利用します。

このアプローチの良い例が、`LabeledInputField`コンポーネントです。このコンポーネントは、ラベルと入力フィールドを組み合わせたもので、アプリケーション内の複数のフォームで利用されています。

- **`LabeledInputField`**: ラベルと入力フィールドを組み合わせた汎用コンポーネント。

このコンポーネントは、ポップアップ画面（`Popup.tsx`）やオプション画面（`Options.tsx`）などで利用されており、UI の一貫性を保ちつつ、各画面の実装を簡素化しています。

このようなコンポーネント指向のアプローチにより、以下のメリットがもたらされます。

- **一貫性の向上**: アプリケーション全体で統一されたデザインの UI を提供できます。
- **再利用性の向上**: 一度作成したコンポーネントを複数の場所で再利用できるため、開発効率が向上します。
- **保守性の向上**: コンポーネントの修正が、それを利用するすべての場所に反映されるため、保守性が向上します。

### エラー処理とロギング

本プロジェクトでは、エラーハンドリングとロギングの品質を向上させるため、エラーメッセージの生成処理を共通化し、ログ出力の仕組みを改善しています。特に、`createErrorMessage`関数を導入することで、エラーメッセージの生成ロジックを一元化し、再利用性と一貫性を高めています。

エラーメッセージを一元管理することで、アプリケーション全体で一貫性のあるエラー情報を提供し、ユーザーが問題の原因を特定しやすくなるよう努めています。また、開発者向けには、デバッグや問題解決を迅速化するために、エラー発生時のコンテキスト情報を含む詳細なログを出力する仕組みを導入しています。具体的には、`console.error`を使用してエラーをログ出力する際に、単なる文字列ではなくエラーオブジェクト全体を渡すように統一しています。これにより、開発者コンソールでスタックトレースやエラーの詳細プロパティを確認でき、迅速なデバッグが可能になります。

この改善により、以下のメリットがもたらされます。

- **ユーザー体験の向上**: 一貫性のある分かりやすいエラーメッセージにより、ユーザーの混乱を軽減します。
- **開発効率の向上**: 詳細なログ情報により、開発者は問題の特定と修正を迅速に行えます。
- **保守性の向上**: エラー処理のロジックが共通化されることで、コードの重複が削減され、保守性が向上します。

さらに、エラー発生時の原因特定をより迅速かつ正確に行うため、エラーメッセージを定数として一元管理し、具体的なエラー内容とエラーオブジェクトを併せてログ出力するように改善しました。例えば、「ストレージからAPIのURLを取得できませんでした」といった具体的なメッセージと共にエラーの詳細が出力されるため、開発者は問題のコンテキストを即座に把握できます。

### テスト

```bash
$ npm test
```

### テストカバレッジの確認

```bash
$ npm run test:coverage
```

### Lint

```bash
$ npm run lint
```

## ライセンス

このプロジェクトは[MIT ライセンス](LICENSE)の下で公開されています。
