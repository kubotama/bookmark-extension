# ブックマークを登録する拡張機能

## 注意事項

この拡張機能は単体では動作しません。この拡張機能を利用するためには[ブックマークを管理する web アプリケーション](https://github.com/kubotama/linkpage)が必要です。

## 機能

この拡張機能は、現在開いているタブの情報をワンクリックで[ブックマーク管理アプリケーション](https://github.com/kubotama/linkpage)に登録します。

- **自動情報取得**: アクティブなタブの URL とタイトルを自動的に取得します。
- **手動編集**: 取得したタイトルや URL は、登録前に手動で編集できます。
- **柔軟な登録**: ページのタイトルが自動で取得できない場合でも（例: `about:blank`ページなど）、手動でタイトルを入力して登録することが可能です。
カスタム API エンドポイント: オプションページで、ブックマーク登録先の API エンドポイントを自由に設定できます。

### 動的なポップアップUI

長いURLやタイトルを扱う際の利便性を向上させるため、ポップアップウィンドウの幅がコンテンツに応じて動的に調整される機能を導入しました。これにより、情報が途切れることなく表示され、常に快適な操作性を提供します。

- **動的な幅調整**: URLの長さに合わせてポップアップの幅が自動的に変わります。
- **レスポンシブデザイン**: CSS Grid Layout を活用し、異なるコンテンツ長に対しても堅牢なレイアウトを維持します。

## インストール方法

### リポジトリのクローン

```bash
$ git clone https://github.com/kubotama/bookmark-extension.git
```

### プロジェクトディレクトリに移動

```bash
$ cd bookmark-extension
```

### パッケージのインストール

```bash
$ npm install
```

### ビルド

```bash
$ npm run build
```

## 使用方法

1.  Chrome で `chrome://extensions` を開きます。
2.  右上の「デベロッパーモード」をオンにします。
3.  「パッケージ化されていない拡張機能を読み込む」ボタンをクリックします。
4.  ビルド時に作成された `dist` ディレクトリを選択して、拡張機能を登録します。
5.  拡張機能のアイコンを右クリックし、「オプション」を選択してオプションページを開きます。
6.  ブックマークを登録するための API エンドポイントの URL を指定します。（デフォルト: `http://localhost:3000/api/bookmarks`）

## 関連アプリケーション

[ブックマークを管理する web アプリケーション](https://github.com/kubotama/linkpage)

## 技術スタック

- [Node.js](https://nodejs.org/)
- [React](https://reactjs.org/)
- [TypeScript](https://www.typescriptlang.org/)
- [vite](https://ja.vite.dev/)
- [vitest](https://vitest.dev)

## 開発

### 非同期処理のモダン化

本プロジェクトでは、コールバックベースの古い非同期処理から、よりモダンで可読性の高い`Promise`ベースの`async/await`構文への移行を推進しています。Chrome 拡張機能 API の呼び出しや、`fetch`による HTTP リクエストなど、プロジェクト全体の非同期コードを`async/await`に統一することで、コードの可読性とメンテナンス性を高めています。

### カスタムフックによる関心の分離

本プロジェクトでは、コンポーネントの責務を明確にし、コードの再利用性と保守性を高めるために、カスタムフックによる関心の分離を積極的に採用しています。

UI ロジックとビジネスロジックを分離するために、複雑な状態管理や副作用を伴う処理はカスタムフックにカプセル化しています。

以下に、本プロジェクトで利用されている主なカスタムフックを示します。

- **`useActiveTabInfo`**: 現在アクティブなタブの URL とタイトルを取得します。
- **`useApiUrl`**: API の URL を取得・設定します。
- **`usePopup`**: ポップアップ画面（`Popup.tsx`）の主要なロジックを集約します。
- **`useOptions`**: オプション画面（`Options.tsx`）の主要なロジックを集約します。

例えば、ポップアップ画面（`Popup.tsx`）の主要なロジックは `usePopup` フックに集約されており、`Popup.tsx` は主に UI のレンダリングに専念する構成となっています。

同様に、オプション画面（`Options.tsx`）のロジックは `useOptions` フックにカプセル化されています。

このアプローチにより、以下のメリットがもたらされます。

- **可読性の向上**: コンポーネントのコードがシンプルになり、見通しが良くなります。
- **再利用性の向上**: 同様のロジックを複数のコンポーネントで簡単に再利用できます。
- **テストの容易性**: ビジネスロジックを UI から切り離して単体でテストすることが容易になります。

### コンポーネント指向の開発

本プロジェクトでは、UI の一貫性を保ち、コードの再利用性を高めるために、コンポーネント指向の開発アプローチを採用しています。共通の UI パターンは、再利用可能なコンポーネントとしてカプセル化し、アプリケーション全体で利用します。

このアプローチの良い例が、`LabeledInputField`コンポーネントです。このコンポーネントは、ラベルと入力フィールドを組み合わせたもので、アプリケーション内の複数のフォームで利用されています。

- **`LabeledInputField`**: ラベルと入力フィールドを組み合わせた汎用コンポーネント。

このコンポーネントは、ポップアップ画面（`Popup.tsx`）やオプション画面（`Options.tsx`）などで利用されており、UI の一貫性を保ちつつ、各画面の実装を簡素化しています。

このようなコンポーネント指向のアプローチにより、以下のメリットがもたらされます。

- **一貫性の向上**: アプリケーション全体で統一されたデザインの UI を提供できます。
- **再利用性の向上**: 一度作成したコンポーネントを複数の場所で再利用できるため、開発効率が向上します。
- **保守性の向上**: コンポーネントの修正が、それを利用するすべての場所に反映されるため、保守性が向上します。

### テスト

```bash
$ npm test
```

### テストカバレッジの確認

```bash
$ npm run test:coverage
```

### Lint

```bash
$ npm run lint
```

## ライセンス

このプロジェクトは[MIT ライセンス](LICENSE)の下で公開されています。
